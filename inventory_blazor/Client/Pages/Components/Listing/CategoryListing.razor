@using inventory_blazor.Shared.Models
@inject HttpClient HttpClient

<div class="min-h-screen flex justify-center items-center">
    <div class="p-8 rounded-lg shadow-lg flex flex-col justify-center items-center">
        <h1 class="text-5xl text-white mb-8">Add Category</h1>
        <form @onsubmit="AddCategory" class="space-y-4 w-full max-w-md">
            <div>
                <label for="cname" class="text-white mb-2">Enter new Category name here:</label>
                <input type="text" id="cname" @bind="newCategory.Category_name"
                       class="mt-3 px-3 py-2 bg-[#41444d] text-white rounded-lg w-full outline-none" />
            </div>
            <button type="submit" class="bg-[#33e67a] hover:bg-[#30995a] text-black font-bold py-2 px-4 rounded w-full">
                Submit
            </button>
        </form>
        <div class="w-full">
            <div class="w-full mx-auto rounded-lg bg-[#2f2f37] text-[#adadad] flex text-center mt-12 items-center shadow-lg py-3">
                <h5 class="w-1/2">Category ID</h5>
                <h5 class="w-1/2">Category Name</h5>
                <h5 class="w-1/2">Action</h5>
            </div>
            
@if (categories != null && categories.Any())
{
    @foreach (var category in categories)
    {
        <div class="w-full">
            <div class="w-full mx-auto rounded-lg bg-[#1e1f23] text-[#adadad] flex mt-4 text-center h-16 items-center shadow-lg hover:contrast-125 transition ease-in-out duration-300 cursor-pointer ">
                    <h5 class="w-1/3">@category.Cid</h5>
                    <h5 class="w-1/3">@category.Category_name</h5>
            <div class="w-1/4 flex justify-center items-center gap-2">
                    <form action="/edit/@category.Cid" method="get">
                        <button class="bg-[#33E67A] font-bold rounded-lg text-black px-3 text-xs py-1">
                            Edit
                        </button>
                    </form>
                    <form action="/delete/@category.Cid" method="post">
                        <button class="bg-[#33E67A] font-bold rounded-lg text-black px-3 text-xs py-1">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
    </div>
    }
}

        </div>
    </div>
</div>


@code {
    private List<Category>? categories;
    private Category newCategory = new Category();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            categories = await HttpClient.GetFromJsonAsync<List<Category>>("api/Category");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error retrieving categories: {ex.Message}");
        }
    }

    private async Task AddCategory()
    {
        try
        {
            await HttpClient.PostAsJsonAsync("api/Category", newCategory);
            newCategory = new Category();
            categories = await HttpClient.GetFromJsonAsync<List<Category>>("api/Category"); 
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error adding category: {ex.Message}");
        }
    }
}
