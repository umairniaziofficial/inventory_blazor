@page "/login"
@using inventory_blazor.Shared.Models
@inject HttpClient Http
@inject NavigationManager Navigation

<PageTitle>Login</PageTitle>
<div class="w-screen h-screen bg-[#18181c] pt-10 flex justify-center items-center text-white">
    <div class="w-4/5 bg-white shadow-lg rounded-lg flex lg:h-[90%] h-[80%]">
        <img src="https://plus.unsplash.com/premium_photo-1664304582040-4f6c69c8380c?w=2000&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxlZGl0b3JpYWwtZmVlZHwxfHx8ZW58MHx8fHx8"
            alt="" class="w-1/2 bg-cover object-cover" />

        <div class="w-1/2 text-black flex flex-col justify-center pl-9 pr-5">
            <h3 class="text-gray-500 pb-5">Welcome to Nizventory</h3>
            <h2 class="font-bold">Login to your account</h2>
            <h3 class="text-xs py-4">
                Don't have an account?
                <a href="/signup" class="text-purple-600 underline hover:font-bold">Sign up</a>
            </h3>

            <form @onsubmit="LoginUser">
                <div class="flex flex-col">
                    <label for="email" class="text-sm py-2">Your Email</label>
                    <input type="email" id="email" @bind="email" placeholder="Enter your Email here"
                        class="border-black text-sm border-2 w-[90%] pl-2 py-2 outline-none" required />
                </div>
                <div class="flex flex-col mt-2">
                    <label for="password" class="text-sm py-2">Password</label>
                    <input type="password" id="password" @bind="password" placeholder="Enter your Password"
                        class="border-black text-sm border-2 w-[90%] pl-2 py-2 outline-none" required />
                </div>

                <div class="mt-3">
                    <button type="submit"
                        class="bg-[#33E67A] mt-3 rounded-sm px-3 py-2 hover:scale-105 text-sm transition-transform duration-300 ease-in-out">
                        Login now
                    </button>
                    <button type="button"
                        class="bg-[#33E67A] mt-3 lg:ml-4 rounded-sm px-3 py-2 hover:scale-105 text-sm transition-transform duration-300 ease-in-out">
                        <i class="fa-brands fa-google mr-3"></i>
                        Sign in with Google
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@code {
    private string email;
    private string password;
    private List<User> users;

    protected override async Task OnInitializedAsync()
    {
        // Fetch all users from the server when the page loads
        users = await Http.GetFromJsonAsync<List<User>>("api/user");
    }

    private async Task LoginUser()
    {
        // Check if the entered email and password match any user
        var user = users.FirstOrDefault(u => u.Email == email && u.Password == password);

        if (user != null)
        {
            // Redirect to "/home" if login is successful
            Navigation.NavigateTo("/home");
        }
        else
        {
            // Display error message if login fails
            Console.WriteLine("Invalid email or password");
        }
    }
}
